\documentclass[12pt]{standalone}
\input{../../tikzpic_packages.tex}

\usepackage{setspace}
\setstretch{.75}	%% linespacing 



\begin{document}
\begin{tikzpicture}[
level0/.style={rounded corners=3mm,thick,fill=gray!20},
level1/.style={rounded corners=1.5mm,thick,fill=gray!35,minimum width=6cm,align=center},
level2/.style={rounded corners=1.5mm,thick,fill=gray!70, text=white,minimum width=5.5cm},
level3/.style={rounded corners=1.5mm,thick,fill=white},
thickArrow/.style={thick,-stealth},
%
matrix1/.style={matrix of nodes,row sep=2.5mm,level1},
title/.style={draw=none,inner sep=0pt}
]
\newcommand{\matrixnode}[2]{
	\path (0,0)node[level2, align=center](#1){{#1} \\ \tiny #2};
}
\newcommand{\othernode}[3]{
	\path #1 node[level1, align=center](#2){\textsc{#2} \\ \tiny #3};
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\matrix[matrix1] (concept) at (0,0){
    |[title]| \textsc{Conceptual Design} \\[-1.75mm] \tiny (basic functionality of the soft robot) \\[-1mm]
    \matrixnode{type}{(bending, stretching, rotating, etc.)} \\
    \matrixnode{number}{(one or several DOF per element)} \\
    \matrixnode{arrangement}{(serial, parallel, hybrid)} \\
    \matrixnode{connection}{(material, form, force)} \\
};
\path (concept.0)++(.2,0)node[rotate=90,below,align=center](elementsDescription){pool of elements \\ \tiny (soft actuators, suction cups, etc.)};
\begin{pgfonlayer}{background}
  \node[level0] [fit = (concept) (elementsDescription)] {};
\end{pgfonlayer}


\draw[thickArrow] (type)--(number);
\draw[thickArrow] (number)--(arrangement);
\draw[thickArrow] (arrangement)--(connection);
\draw[thickArrow] (connection.5)--++(.2,0)|-(arrangement.-5);
\draw[thickArrow] (arrangement.5)--++(.2,0)|-(number.-5);
\draw[thickArrow] (number.5)--++(.2,0)|-(type.-5);   % standard
%\draw[thickArrow] (number.5)--++(.6,0)|-(type.-5);		% for long description


%\draw[thickArrow] (connection.5)--++(.2,0)|-(type.-5);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\othernode{($(concept.90)+(0,1)$)}{solution}{(natural systems, creativity methods, etc.)}
\othernode{($(solution.90)+(0,1)$)}{task}{(embodied intelligence, resilience, safety, etc.)}
\othernode{($(concept.270)+(0,-1)$)}{model}{(functionality, kinematics, dynamics, etc.)}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\matrix[matrix1, below] (geometry) at ($(model.270)+(0,-.5)$){
    |[title]| \textsc{Geometrical Design} \\[-1.75mm] \tiny (geometrical elaboration of the soft robot) \\[-1mm]
    \matrixnode{shape}{(compliance, functional integration, etc.)} \\
    \matrixnode{material}{(silicone-based elastomers, granules, etc.)} \\
    \matrixnode{surface}{(traction, electronics, camouflage, etc.)} \\
    \matrixnode{dimension}{(FEM analysis, experimental testing, etc.)} \\
};
\path (geometry.0)++(.2,0)node[rotate=90,below,align=center](fabricationDescription){type of fabrication \\ \tiny (casting, 3D printing, etc.)};
\begin{pgfonlayer}{background}
  \node[level0] [fit = (geometry) (fabricationDescription)] {};
\end{pgfonlayer}


\draw[thickArrow] (shape)--(material);
\draw[thickArrow] (material)--(surface);
\draw[thickArrow] (surface)--(dimension);
\draw[thickArrow] (dimension.5)--++(.2,0)|-(surface.-5);
\draw[thickArrow] (surface.5)--++(.2,0)|-(material.-5);
\draw[thickArrow] (material.5)--++(.2,0)|-(shape.-5);

%\draw[thickArrow] (dimension.5)--++(.2,0)|-(shape.-5);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\othernode{($(geometry.270)+(0,-1)$)}{realization}{(control design, robot testing)}

\draw[thickArrow] (task) -- (solution);
\draw[thickArrow] (solution) -- (concept);
\draw[thickArrow] (concept) -- (model);
\draw[thickArrow] (model) -- (geometry);
\draw[thickArrow] (geometry) -- (realization);

\draw[thickArrow] (model.east)--++(.4,0)|-($(concept.south east)+(0,.2)$);
\draw[thickArrow] (realization.east)--++(.4,0)|-($(geometry.south east)+(0,.2)$);


\end{tikzpicture}
\end{document}
