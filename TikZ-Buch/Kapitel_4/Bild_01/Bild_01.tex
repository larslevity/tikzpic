\input{../../TikZ_header.tex}


%% Arbeitszeit:
% 25.01.16 : 1200 - 1300
% 1500 - 1640
% ges = 120+40 = 160 min

\begin{document}
\begin{tikzpicture}[remember picture]







\def\a{4}
\def\b{6.5}

\def\y{2}
\def\yi{4.3}
\def\yii{5.6}

\def\z{.5}
\pgfmathsetmacro{\zh}{.5*\z}

\def\abs{.3}



%
%
%
%% 1 Zeile
\draw (0,0)rectangle++(\a,-\y);
\draw (0,0)--++(\a,-\y);
\path (0,-\y) node[above right]{Phasen};
\path (\a,0)node[below left, align=right]{Bearbeitungs- \\ ebenen};
\foreach \x/\dx/\t in {\a/\b/Bearbeiten,
\a+\b/\a/ Steuern,
\a+\a+\b/\a/ Entscheiden}{
\draw[fill=gray!5] (\x,0)rectangle++(\dx,-\y)node[midway]{\textbf{\t}};
}









%
%
%% 2 Zeile
\pgfmathsetmacro{\yy}{-\y}
\draw[fill=gray!5] (0,\yy)rectangle++(\a,-\yi)node[midway]{I~~\textbf{Planen}};

\draw (\a,\yy)rectangle++(\b,-\yi);

\path (\a+\abs,\yy-\abs)node[below right,align=left]{Ideen:~~\begin{tabular}{|l|}
\hline
Aufgabe (Problem) \\ \hline
Funktionen \\ \hline
Wirkprinzipien \\ \hline
Konstr. Elemente \\ \hline
Gesamtkonstr. (Skizze) \\ \hline
\end{tabular} \\
~ \\
Bewerten
};



\draw (\a+\b,\yy) rectangle++(\a,-\yi);
\path (\a+\b+\abs,\yy-\abs)node[below right,align=left]{
\tikz[remember picture]\node(I){Ideen}; \\
~ \\
~ \\
~ \\
\tikz[remember picture]\node(D){Dokumentieren}; \\
\tikz[remember picture]\node(A){Auswerten}; \\
};
\pgfmathsetmacro{\da}{-2.5*\abs}
\draw[-latex] (I.west)--++(\da,0);
\draw[latex-] (D.west)--++(\da,0);
\draw[-latex] (D.185)--++(20:\da+\da);

\draw[latex-] (A.west)--++(\da,0);



\draw (\a+\b+\a,\yy) rectangle++(\a,-\yi);
\path (\a+\b++\a\abs,\yy-\abs)node[below right,align=left]{
~ \\
~ \\
~ \\
~ \\
~ \\
\tikz[remember picture]\node[align=left](E){Entscheiden \\ (Auswahl)}; \\
\tikz[remember picture]\node[draw](A){Aufgabe}; 
};
\draw[latex-] (E.west)--++(\da,0);
\draw[-latex] (A.south)|-++(\da+\da,-\z-.35);









%% 3 Zeile
\pgfmathsetmacro{\yy}{-\y-\yi}
\draw[fill=gray!5] (0,\yy)rectangle++(\a,-\yii)node[midway]{II~~\textbf{Entwerfen}};

\draw (\a,\yy)rectangle++(\b,-\yii);

\path (\a+\abs+\abs,\yy-\abs)node[below right,align=left]{\begin{tabular}{|l|}
\hline
Aufgabe $\leftarrow$ Anford.-Liste \\ \hline
Funktionen \\ \hline
Wirkprinzipien \\ \hline
Konstruktionselemente \\ \hline
Gesamtkonstruktion (Skizze) \\ \hline
\end{tabular} \\
~ \\
Marktuntersuchung \\
Fertigen von Mustern \\
Versuche \\
Techn.-wirtsch. Bewertung \\
Konstruktive Verbesserung
};



\draw (\a+\b,\yy) rectangle++(\a,-\yii);
\path (\a+\b+\abs,\yy-\abs)node[below right,align=left]{
\tikz[remember picture]\node(P){Projekt starten}; \\
Zeit- und \\
Kostenplanung \\
~ \\
~ \\
Überwachung\\
~ \\
~ \\
~ \\
\tikz[remember picture]\node(B){Bericht}; \\
};
\pgfmathsetmacro{\da}{-2.5*\abs}
\draw[-latex] (P.west)--++(\da,0);
\draw[latex-] (B.west)--++(\da,0);



\draw (\a+\b+\a,\yy) rectangle++(\a,-\yii);
\path (\a+\b++\a\abs,\yy-\abs)node[below right,align=left]{
~ \\
~ \\
~ \\
~ \\
~ \\
~ \\
~ \\
~ \\
~ \\
\tikz[remember picture]\node[align=left](E){Entscheiden}; \\
\tikz[remember picture]\node[draw](A){Aufgabe}; 
};
\draw[latex-] (E.west)--++(\da,-\z);
\draw[-latex] (A.south)|-++(\da+\da,-\z-.35);

%% Pfeile
\draw[-latex] (\a+\abs+\abs,\yy-\yii+\zh+.1) --++(-\abs,0)|-++(\abs,2.6)coordinate(X);
\path (X)++(-\abs,0)coordinate(last);
\foreach \y in {1,2,3,4} {
\draw[-latex] (last)--++(0,\z)coordinate(last)--++(\abs,0);
}



%\draw[latex-] (\a+\b-\abs,\yy-\zh) --++(\abs+\abs,0)node[right]{Ideen};
%\pgfmathsetmacro{\dy}{4*\z}
%\draw[-latex] (\a+\b-\abs,\yy-\dy-\zh) --++(\abs+\abs,0)node(X)[right]{Dokumentieren};
%\draw[-latex] (X.185)-|++(-\abs-\abs,-\zh)--++(-\abs-\abs,0);
%
%\pgfmathsetmacro{\dy}{5*\z}
%\draw[-latex] (\a+\b-\abs,\yy-\dy-\zh) --++(\abs+\abs,0)node[right]{Auswerten};
%
%\draw (\a+\b+\a,\yy)rectangle++(\a,-\yi);
%\draw[-latex] (\a+\b+\a-\abs,\yy-\dy-\zh) --++(\abs+\abs,0)node[right, align=left]{Entscheiden \\  (Auswahl)};





%% 4 Zeile
\pgfmathsetmacro{\yy}{-\y-\yi-\yii}
\draw[fill=gray!5] (0,\yy)rectangle++(\a,-\yii)node[midway]{III~~\textbf{Ausarbeiten}};

\draw (\a,\yy)rectangle++(\b,-\yii);

\path (\a+\abs+\abs,\yy-\abs)node[below right,align=left]{\begin{tabular}{|l|}
\hline
Anforderungsliste \\ \hline
Funktionen \\ \hline
Wirkprinzipien \\ \hline
Konstruktionselemente \\ \hline
Gesamtkonstruktion\\ \hline
\end{tabular} \\
~ \\
Marktuntersuchung \\
Prototypfertigung \\
Tests \\
Vorkalkulation \\
Konstruktive Verbesserung
};



\draw (\a+\b,\yy) rectangle++(\a,-\yii);
\path (\a+\b+\abs,\yy-\abs)node[below right,align=left]{
\tikz[remember picture]\node(P){Zeitplanung}; \\
Kostenplanung \\
~ \\
~ \\
~ \\
Überwachung\\
~ \\
~ \\
~ \\
\tikz[remember picture]\node(B){Bericht}; \\
};
\pgfmathsetmacro{\da}{-2.5*\abs}
\draw[-latex] (P.west)--++(\da,0);
\draw[latex-] (B.west)--++(\da,0);
\draw[-latex] (B.east)-|++(-\da,\da);



\draw (\a+\b+\a,\yy) rectangle++(\a,-\yii);
\path (\a+\b++\a\abs,\yy-\abs)node[below right,align=left]{
~ \\
~ \\
~ \\
~ \\
~ \\
~ \\
~ \\
~ \\
~ \\
\tikz[remember picture]\node[minimum height=.5cm](E){~}; \\
\tikz[remember picture]\node(A){Entscheiden}; 
};
\draw[latex-] (A.west)--++(\da,0);
\draw[-latex] (A.east)-|++(-\da,\da);


%% Pfeile
\draw[-latex] (\a+\abs+\abs,\yy-\yii+\zh+.1) --++(-\abs,0)|-++(\abs,2.6)coordinate(X);
\path (X)++(-\abs,0)coordinate(last);
\foreach \y in {1,2,3,4} {
\draw[-latex] (last)--++(0,\z)coordinate(last)--++(\abs,0);
}


\draw[decorate,decoration=brace] (\a+\b+-\z+\da-.1,\yy-\abs-\zh+.1)--++(0,-\z-\z-\z)node[midway,right,align=left]{bei \\ Bedarf};


%%%%%%%%% Zeile 4
\pgfmathsetmacro{\yy}{-\y-\yi-\yii - \yii}

\draw (\a+\b,\yy) rectangle++(\a,-1.2)node[midway]{Dokumentation};

\path (\a+\b+\a+\a,\yy-.6) node[left]{Fertigen};




\end{tikzpicture}
\end{document}