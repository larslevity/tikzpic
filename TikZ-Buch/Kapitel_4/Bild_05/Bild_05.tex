\input{../../TikZ_header.tex}


%% Arbeitszeit:
% 27.01.16 : 1110 -1310
% ges = 120 min

\begin{document}
\begin{tikzpicture}[scale=1]

%% Params

\def\dx{5}
\pgfmathsetmacro{\xh}{\dx*.5}
\def\y{15}
\pgfmathsetmacro{\dy}{\y/5}
\def\da{3}



\draw[fill=gray!5] (0,0)rectangle++(\dx,-\y);
\draw[fill=gray!10] (\dx,0)rectangle++(\dx,-\y);
\draw[fill=gray!15] (\dx+\dx,0)rectangle++(\dx,-\y);


\foreach \xx/\t in {\xh/Eingang,\dx+\xh/Inneres,\dx+\dx+\xh/Ausgang}{
\path (\xx,0)node[below,draw]{\t};}

\newcommand{\te}[1]{#1}


\begin{scope}[every node/.style={fill=white,draw,align=center, minimum height = 1.5cm, minimum width = 3.3cm}]

% Erste Spalte
\pgfmathsetmacro{\yy}{-1*\dy}
\path (\xh,\yy) node(1){Öl ein- \\ bringen};
\pgfmathsetmacro{\yy}{-2*\dy}
\path (\xh,\yy) node(2){$M_1$ einleiten \\ $\omega_1$ einleiten};
\pgfmathsetmacro{\yy}{-3*\dy}
\path (\xh,\yy) node(3){$\omega_1 - \omega_2 \lessgtr 0$ \\ feststellen};
\pgfmathsetmacro{\yy}{-4*\dy}
\path (\xh,\yy) node(4)[fill=gray!50]{Schaltenergie \\ speichern (Feder)};

% Zweite Spalte
\pgfmathsetmacro{\yy}{-1*\dy}
\path (\xh+\dx,\yy) node(5){Öl an \\ Wirkort bringen};
\pgfmathsetmacro{\yy}{-2*\dy}
\path (\xh+\dx,\yy) node(6){$M_1$ und $\omega_1$ \\ übertragen/ \\ unterbrechen};
\pgfmathsetmacro{\yy}{-3*\dy}
\path (\xh+\dx,\yy) node(7){Schaltvorgang \\ steuern};

% Dritte Spalte
\pgfmathsetmacro{\yy}{-1*\dy}
\path (\xh+\dx+\dx,\yy) node(8){Öl abführen \\ Abrieb abführen};
\pgfmathsetmacro{\yy}{-2*\dy}
\path (\xh+\dx+\dx,\yy) node(9){$M_1$ und $\omega_1$ \\ ableiten};

\end{scope}

%%%%%
\foreach[count=\i] \t in {\textbf{Stoff}, \textbf{Energie}, \textbf{Information/} \\ \textbf{Signal}}
{
\pgfmathsetmacro{\yy}{-\i*\dy+1}
\path (-2,\yy)node[align=center]{\t};
}

%%%%%%%%%%%% Pfeile
\draw[dotted,-latex,gray!50,very thick] (4)--(3);
\draw[-latex,gray!50,very thick] (4.east)-|(7)node[pos=.25,below=.2cm,sloped,black,draw]{\small{Federenergie}};
\draw[latex-,gray!50,very thick] (4.west)--++(-\da,0)node[near end,above,black]{{Vorspannung}};



% Alle Stoff
\begin{scope}[line width = .1cm,gray]
\draw[latex-] (1.west)--++(-\da,0)node[near end,above,black]{Öl};
\draw[-latex] (1)--(5);
\draw[-latex] (5.190)--++(-1,0)--++(0,-\dy-1.3)coordinate(help)-|(3.30);
\draw[-latex] (help)-|(7.150);
\draw[-latex] (5)--(6);
\draw[-latex] (6.18)--++(1,0)|-(8);
\draw[-latex] (8.east)--++(\da,0)node[near end,above,black]{Öl}node[near end, below, black]{Abrieb};

\end{scope}

%%%% Alle Energie1
\begin{scope}[line width=.08cm]
\draw[latex-] (2.170)--++(-\da,0)node[near end,above]{$M_1$};
\draw[latex-] (2.180)--++(-\da,0)node[near end,below]{$\omega_1$};
\draw[latex-,dotted] (2.200)--++(-\da,0)node[near end,above]{};
\draw[-latex,dotted] (2.230)--(3.130)node[pos=.6,left]{$\omega_1$};
\draw[-latex,dotted] (9.south)--++(0,-.3)-|(3)node[pos=.75,right]{$\omega_2$};

\draw[-latex](2.10)--(6.170);
\draw[-latex] (2)--(6);

\draw[-latex](6.10)--(9.170);
\draw[-latex] (6)--(9);


\draw[-latex](9.10)--++(\da,0)node[near end,above]{$M_2$};
\draw[-latex] (9.0)--++(\da,0)node[below,near end]{$\omega_2$};
\draw[latex-,dotted] (9.340)--++(\da,0);

\draw[-latex] (7.80)--(6.280)node[pos=.4, left,align=right]{ Schalt- \\ energie};

\draw[-latex,dotted] (7.40)--(6.320)node[pos=.4, right,align=left]{ Schalt- \\ signal};

\draw[-latex] (2)--(7);


\end{scope}

\end{tikzpicture}
\end{document}