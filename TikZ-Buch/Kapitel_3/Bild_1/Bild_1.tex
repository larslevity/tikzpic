\input{../../TikZ_header.tex}


%% Arbeitszeit:
% 12.11.15 : 1400-1550
% 12.11.15 : 1130-1230

\begin{document}
\begin{tikzpicture}


% Params
\def\xbcm{5cm}
\def\xb{5} % Change always both!
\def\xabs{10}
\def\yabs{-1.3}



% Wanne
\newcommand{\wanne}[5]{
\path (#1,#2) node(#4)[minimum width=\xbcm, align = center,minimum height = 1.5cm, rectangle, draw=none]{};
\draw[very thick] ($(#4.west)+(-.3,.3)$)--(#4.south west)coordinate[pos=.5](1)coordinate[pos=.8](3)--(#4.south east)--($(#4.east)+(.3,.3)$)coordinate[pos=.5](2)coordinate[pos=.2](4);
\ifthenelse{#5=1}{
\fill[gray!10] (1)--(#4.south west)--(#4.south east)--(2);
\draw[dashed] (1)--(2);
\draw[very thick] ($(#4.west)+(-.3,.3)$)--(#4.south west)coordinate[pos=.5](1)--(#4.south east)--($(#4.east)+(.3,.3)$)coordinate[pos=.5](2);
\path (#4) node[align = center] {#3};
}{
\fill[gray!10] (3)--(#4.south west)--(#4.south east)--(4);
\draw[dashed] (3)--(4);
\draw[very thick] ($(#4.west)+(-.3,.3)$)--(#4.south west)coordinate[pos=.5](1)--(#4.south east)--($(#4.east)+(.3,.3)$)coordinate[pos=.5](2);
\path (#4) node[align = center] {#3};
}
}

% Nodes
\wanne{0}{0}{Ideen sammeln, \\ sortieren und aufbereiten}{Wanne1}{1};
\wanne{\xabs}{\yabs}{1. Entscheidung \\ (Grobfilter)}{Wanne2}{0};
\wanne{0}{\yabs+\yabs}{Ideen durcharbeiten, \\ funktionsfähig machen, \\ testen}{Wanne3}{1};
\wanne{\xabs}{\yabs+\yabs+\yabs}{2. Entscheidung \\ (Mittelfilter)}{Wanne4}{0};
\wanne{0}{\yabs+\yabs+\yabs+\yabs}{Vorschläge ausarbeiten, \\ optimieren}{Wanne5}{1};
\wanne{\xabs}{\yabs+\yabs+\yabs+\yabs+\yabs}{3. Entscheidung \\ (Feinfilter)}{Wanne6}{0};
% Produkt
\path(0,\yabs+\yabs+\yabs+\yabs+\yabs+\yabs-.33) node[minimum width=\xbcm+.5cm,minimum height=1cm,rectangle,draw,very thick,fill=gray!10]{Produkt herstellen};



% Pfeile
\pgfmathsetmacro{\yabsnew}{\yabs*.5}
\pgfmathsetmacro{\alp}{atan(\yabsnew/(\xabs-\xb))}

\foreach \i/\t in{1/1,3/2,5/3}{
\fill[white] (Wanne\i.south east)++(-.1,0)--++(\xabs-\xb,\yabsnew)--++(90+\alp:.2)--++(-\xabs+\xb,-\yabsnew);
\draw[very thick] (Wanne\i.south east)++(-.1,0)--++(\xabs-\xb,\yabsnew)coordinate(help)++(90+\alp:.2)--++(-\xabs+\xb,-\yabsnew)node[midway,above=.2cm,rectangle,draw=none,fill=gray!20]{Phase \t};
\draw[-latex,very thick,gray!50] (help)++(90+\alp:.1)++(180+\alp:\xb)--++(\alp:\xb+.3);
}
\foreach \i in {2,4,6}{
\fill[white] (Wanne\i.south west)++(.1,0)--++(-\xabs+\xb,\yabsnew)--++(90-\alp:.2)--++(\xabs-\xb,-\yabsnew);
\draw[very thick] (Wanne\i.south west)++(.1,0)--++(-\xabs+\xb,\yabsnew)coordinate(help)++(90-\alp:.2)--++(\xabs-\xb,-\yabsnew);
\draw[-latex,very thick,gray!50] (help)++(90-\alp:.1)++(-\alp:\xb)--++(180-\alp:.3+\xb);
}


% Abfall
\def\alp{18}
\foreach \i/\t in {2/Schrott,4/Abfall,6/Abfall bzw. Reserve}{
\draw[very thick] (Wanne\i.south east)++(90-\alp:.22)coordinate(help2)--++(1,-1)coordinate(help)++(90-\alp:.3)--++(-1,1)coordinate(help3);
\fill[white] (help3)rectangle++(-.2,-.26);
\draw[-latex,very thick,gray!50] (help)++(45:.135)++(135:.8)--++(-45:1.2)node[below,black]{\t};
}


% Kategorisierung
\pgfmathsetmacro{\xx}{\xb*1.2*.5}
\pgfmathsetmacro{\yy}{\yabs*8.3}
\pgfmathsetmacro{\xmid}{\xabs*.5}

\draw[help lines,dashed] (\xx,.5)--++(0,\yy);
\draw[help lines,dashed] (\xabs-\xx,.5)--++(0,\yy);
\path (0,\yy+1)node{\textit{Bearbeiten}};
\path (\xmid,\yy+1)node{\textit{Steuern}};
\path (\xabs,\yy+1)node{\textit{Entscheiden}};



\end{tikzpicture}
\end{document}